#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./test-api.sh

BASE_URL="http://localhost:3000"

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Back Catalog API"
echo "================================="
echo ""

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
echo -e "${BLUE}üìã –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π${NC}"
curl -s "$BASE_URL/api/categories" | jq '.[0:2]'
echo -e "${GREEN}‚úì –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã${NC}\n"

# –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
echo -e "${BLUE}üì¶ –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤${NC}"
curl -s "$BASE_URL/api/products" | jq '.[0:2]'
echo -e "${GREEN}‚úì –ü—Ä–æ–¥—É–∫—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã${NC}\n"

# –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π
echo -e "${BLUE}üé® –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π${NC}"
curl -s "$BASE_URL/api/collections" | jq '.[0:1]'
echo -e "${GREEN}‚úì –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã${NC}\n"

# –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
echo -e "${BLUE}‚öôÔ∏è  –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞${NC}"
curl -s "$BASE_URL/api/settings/phone" | jq '.'
echo -e "${GREEN}‚úì –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã${NC}\n"

# –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–∏–∑ –∫—ç—à–∞)
echo -e "${BLUE}‚ö° –¢–µ—Å—Ç 5: –ò–∑–º–µ—Ä–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–∞ (–∏–∑ –∫—ç—à–∞)${NC}"
time curl -s "$BASE_URL/api/products" > /dev/null
echo -e "${GREEN}‚úì –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω –∏–∑ –∫—ç—à–∞${NC}\n"

# –¢–µ—Å—Ç 6: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
echo -e "${BLUE}‚ûï –¢–µ—Å—Ç 6: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏${NC}"
NEW_CATEGORY=$(curl -s -X POST "$BASE_URL/api/categories" \
  -H "Content-Type: application/json" \
  -d '{"name":"–¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"}')
echo "$NEW_CATEGORY" | jq '.'
CATEGORY_ID=$(echo "$NEW_CATEGORY" | jq -r '.id')
echo -e "${GREEN}‚úì –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞ —Å ID: $CATEGORY_ID${NC}\n"

# –¢–µ—Å—Ç 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
echo -e "${BLUE}‚úèÔ∏è  –¢–µ—Å—Ç 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏${NC}"
curl -s -X PUT "$BASE_URL/api/categories/$CATEGORY_ID" \
  -H "Content-Type: application/json" \
  -d '{"name":"–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"}' | jq '.'
echo -e "${GREEN}‚úì –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞${NC}\n"

# –¢–µ—Å—Ç 8: –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
echo -e "${BLUE}üóëÔ∏è  –¢–µ—Å—Ç 8: –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏${NC}"
curl -s -X DELETE "$BASE_URL/api/categories/$CATEGORY_ID" | jq '.'
echo -e "${GREEN}‚úì –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞${NC}\n"

# –¢–µ—Å—Ç 9: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
echo -e "${BLUE}üîç –¢–µ—Å—Ç 9: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏${NC}"
curl -s "$BASE_URL/api/products?categoryId=cat-4" | jq '.[0:1]'
echo -e "${GREEN}‚úì –ü—Ä–æ–¥—É–∫—Ç—ã –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã${NC}\n"

# –¢–µ—Å—Ç 10: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
echo -e "${BLUE}üîê –¢–µ—Å—Ç 10: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏${NC}"
curl -s -X POST "$BASE_URL/api/admin/auth" \
  -H "Content-Type: application/json" \
  -d '{"password":"wrong_password"}' | jq '.'
echo -e "${GREEN}‚úì –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞${NC}\n"

echo -e "${GREEN}================================="
echo -e "‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"
echo -e "=================================${NC}"
echo ""
echo "üí° –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "   curl -X POST -F \"image=@/path/to/image.jpg\" $BASE_URL/api/upload"

